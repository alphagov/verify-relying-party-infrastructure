# Terraform

## Overview

[Terraform](https://www.terraform.io/) is an infrastructure as code tool which
can build infrastructure in the cloud.

This directory contains terraform configuration which creates an environment in
Amazon Web Services (AWS). The environment hosts a service which connects to the
GOV.UK Verify Integration environment.

## Getting Started

Set up your AWS credentials by following the instructions in [Assuming Roles](https://github.com/alphagov/verify-terraform#assuming-roles), then:

```bash
cd terraform

# To see what Terraform thinks it should do:
terraform apply
```

If the plan presented by Terraform seems okay, type "yes" to have it executed, which would then setup the actual environment. 

Note: Terraform now presents the result of `plan` command first when running `apply`, which must then be accepted in order to actually build the environment. Due to this, `plan` does not need to be executed explicitly.

In order to run front-end tests against the Compliance Tool, we need to be able to refer to our 
front-end by a domain name. Currently, the new environment built by this repo is not assigned a 
domain name. But we can utilise the random public domain generated by AWS, until we are in a 
position to point a dedicated (sub) domain to it. Therefore, once Terraform has finished 
executing the plan, you should to see a list of output values shown, one of which is the IP 
address of the EC2 instance running the front-end (a Node.js app). The value provided by the 
value `relying_party_ip` includes the IP address of the EC2 instance. You should be able to 
get the public domain name corresponding to the IP address by running the command 
`host <IP-address>`. Then, open the app in your browser by opening this domain 
name and using the port `3200` (i.e. http://<domain-name>:3200). This should open the web page
for the front-end app, where various tests can be run against the Compliance Tool.
